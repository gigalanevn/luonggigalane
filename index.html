<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B·∫£ng T√≠nh L∆∞∆°ng Chuy√™n Nghi·ªáp - 2025</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 10px; background: #f4f7f6; color: #333; margin: 0; }
        .container { background: white; padding: 15px; max-width: 1300px; margin: 0 auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; }
        h2 { text-align: center; color: #1a73e8; text-transform: uppercase; font-size: 18px; margin: 5px 0 10px 0; }
        
        /* 1. L·ªöP PH·ª¶ TH√îNG B√ÅO XOAY M√ÄN H√åNH */
        #rotation-notice {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(26, 115, 232, 0.98);
            color: white;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        /* Ch·ªâ hi·ªÉn th·ªã khi m√†n h√¨nh d·ªçc tr√™n thi·∫øt b·ªã di ƒë·ªông */
        @media screen and (max-width: 900px) and (orientation: portrait) {
            #rotation-notice { display: flex; }
        }

        .phone-icon {
            width: 50px; height: 90px; border: 3px solid white; border-radius: 8px;
            margin-bottom: 20px; animation: rotateDevice 2s ease-in-out infinite;
            position: relative;
        }
        .phone-icon::after {
            content: ""; position: absolute; bottom: 5px; left: 50%;
            transform: translateX(-50%); width: 8px; height: 8px;
            background: white; border-radius: 50%;
        }
        @keyframes rotateDevice {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
            100% { transform: rotate(90deg); }
        }

        .btn-bypass {
            margin-top: 25px; padding: 12px 24px; border-radius: 25px;
            border: none; background: white; color: #1a73e8;
            font-weight: bold; font-size: 14px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* 2. H∆Ø·ªöNG D·∫™N */
        .instruction-box { 
            background: #fff8e1; border-left: 5px solid #ffc107; 
            padding: 10px; margin-bottom: 15px; font-size: 12px; 
            line-height: 1.5; border-radius: 4px;
        }
        .step-tag { background: #1a73e8; color: white; padding: 1px 6px; border-radius: 10px; font-size: 10px; margin-right: 5px; font-weight: bold; }

        /* 3. B·∫¢NG BI·ªÇU (T·ª± ƒë·ªông hi·ªán thanh cu·ªôn ngang n·∫øu m√†n h√¨nh h·∫πp) */
        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; background: #fff; min-width: 1000px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: center; font-size: 10.5px; word-wrap: break-word; }
        .section-head { background: #e8f0fe; font-weight: bold; color: #1a73e8; position: relative; height: 35px; }
        
        .btn-clear-section { 
            position: absolute; right: 5px; top: 50%; transform: translateY(-50%);
            background: #ff5252; color: white; border: none; padding: 3px 6px; 
            border-radius: 3px; cursor: pointer; font-size: 9px;
        }

        .total-cell { background: #fff9c4; font-weight: bold; color: #b71c1c; } 
        .tc-base-cell { background: #e7f3ff; font-weight: bold; color: #0d47a1; }
        .res-num { color: #01579b; font-weight: bold; } 
        .pc-res-val { color: #2e7d32; font-style: italic; font-size: 10px; background: #f9f9f9; }
        .auto-fill { background: #f1f8e9; font-weight: bold; color: #2e7d32; border: 1.5px solid #2e7d32 !important; }
        
        .info-bar { display: flex; justify-content: space-around; align-items: center; margin-bottom: 10px; padding: 10px; background: #fff; border: 1px solid #1a73e8; border-radius: 5px; flex-wrap: wrap; gap: 10px; }
        .debug-item { font-size: 13px; font-weight: bold; border-right: 1px solid #ddd; padding-right: 15px; }
        
        input { width: 90%; padding: 4px; text-align: right; border: 1px solid #ccc; border-radius: 3px; font-size: 11px; }
        input[readonly] { background-color: #eee; cursor: not-allowed; font-weight: bold; color: #555; }
        
        .final-box { background: #1a73e8; color: white; padding: 12px; border-radius: 5px; text-align: right; margin-top: 5px; }
        .grand-total { font-size: 28px; font-weight: bold; color: #ffeb3b; margin-left: 10px; }
    </style>
</head>
<body>

<div id="rotation-notice">
    <div class="phone-icon"></div>
    <h3 style="margin: 10px 20px;">VUI L√íNG XOAY NGANG M√ÄN H√åNH</h3>
    <p style="padding: 0 20px; font-size: 14px; opacity: 0.9;">B·∫£ng t√≠nh c√≥ nhi·ªÅu c·ªôt, xoay ngang s·∫Ω gi√∫p b·∫°n d·ªÖ nh·∫≠p li·ªáu v√† ch√≠nh x√°c h∆°n.</p>
    <button class="btn-bypass" onclick="hideNotice()">Ti·∫øp t·ª•c d√πng m√†n h√¨nh d·ªçc</button>
</div>

<div class="container">
    <h2>B·∫¢NG T√çNH L∆Ø∆†NG CHI TI·∫æT</h2>

    <div class="instruction-box">
        <div><span class="step-tag">L·∫¶N ƒê·∫¶U:</span> Nh·∫≠p <b>C√¥ng</b> ‚ûî <b>L∆∞∆°ng & Ph·ª• c·∫•p</b> ‚ûî Nam: B·ªè ch·ªçn <b>"PC Ph·ª• n·ªØ"</b> ‚ûî Nh·∫≠p <b>TƒÉng ca</b>.</div>
        <div><span class="step-tag">L·∫¶N SAU:</span> Ch·ªâ c·∫ßn nh·∫≠p <b>Gi·ªù tƒÉng ca</b> & <b>C√¥ng th·ª±c t·∫ø</b> (M√°y ƒë√£ t·ª± l∆∞u d·ªØ li·ªáu c≈©).</div>
    </div>

    <div class="info-bar">
        <div style="display: flex; gap: 10px; border-right: 1px solid #ddd; padding-right: 15px;">
            <label style="font-size: 12px; font-weight: bold;">C√¥ng chu·∫©n: <input type="number" id="soCongChuan" value="26" style="width: 30px;"></label>
            <label style="font-size: 12px; font-weight: bold;">Th·ª±c t·∫ø: <input type="text" class="money save" id="soNgayGio" value="26" style="width: 40px;"></label>
        </div>
        <div class="debug-item" style="color: #e91e63;">L∆∞∆°ng ng√†y c√¥ng: <span id="show_luong_ngay_cong">0</span></div>
        <div class="debug-item" style="color: #2e7d32;">T·ªïng Ph·ª• c·∫•p: <span id="show_total_pc">0</span></div>
        <div class="debug-item">T·ªïng l∆∞∆°ng t√≠nh tƒÉng ca: <span id="show_goc" class="res-num">0</span></div>
    </div>

    <div class="table-responsive">
        <table>
            <tr class="section-head">
                <th colspan="12">1. TH√îNG TIN L∆Ø∆†NG (C·ªê ƒê·ªäNH) <button class="btn-clear-section" onclick="clearSection1()">üóë Xo√° m·ª•c 1</button></th>
            </tr>
            <tr style="color: #555; background: #fafafa;">
                <th class="tc-base-cell">L∆∞∆°ng CB</th><th class="tc-base-cell">Ch·ª©c v·ª•</th><th class="tc-base-cell">K·ªπ nƒÉng</th>
                <th>ATVSV</th><th>PCCC</th><th class="tc-base-cell">Soi k√≠nh</th><th class="tc-base-cell">Th√¢m ni√™n</th>
                <th>ƒêT</th><th class="tc-base-cell">Nh√† ·ªü</th><th>ƒêi l·∫°i</th><th>C.C·∫ßn</th><th class="total-cell">T·ªïng (1) Full</th>
            </tr>
            <tr>
                <td><input type="text" class="money save group1" id="luongCB"></td>
                <td><input type="text" class="money save group1" id="pccv"></td>
                <td><input type="text" class="money save group1" id="pckn"></td>
                <td><input type="text" class="money save group1" id="pcat"></td>
                <td><input type="text" class="money save group1" id="pcpccc"></td>
                <td><input type="text" class="money save group1" id="pcsk"></td>
                <td><input type="text" class="money save group1" id="pctn"></td>
                <td><input type="text" class="money save group1" id="pcdt"></td>
                <td><input type="text" class="money save group1" id="pcno"></td>
                <td><input type="text" class="money save group1" id="pcdl"></td>
                <td><input type="text" class="money save group1" id="pccc"></td>
                <td rowspan="2" id="tong1" class="total-cell"></td>
            </tr>
            <tr>
                <td style="font-size: 9px; color: #888;">Th·ª±c t·∫ø -></td>
                <td id="res_pccv" class="pc-res-val"></td><td id="res_pckn" class="pc-res-val"></td><td id="res_pcat" class="pc-res-val"></td>
                <td id="res_pcpccc" class="pc-res-val"></td><td id="res_pcsk" class="pc-res-val"></td><td id="res_pctn" class="pc-res-val"></td>
                <td id="res_pcdt" class="pc-res-val"></td><td id="res_pcno" class="pc-res-val"></td><td id="res_pcdl" class="pc-res-val"></td>
                <td id="res_pccc" class="pc-res-val"></td>
            </tr>
        </table>
    </div>

    <div class="table-responsive">
        <table>
            <tr class="section-head"><th colspan="10">2. KHO·∫¢N THU KH√ÅC</th></tr>
            <tr style="color: #555; background: #fafafa;">
                <th width="12%">M√¥ t·∫£</th><th>Ph√©p t·ªìn</th><th>ƒê/C l∆∞∆°ng</th><th>Th∆∞·ªüng ƒë·ªÅ √°n</th><th>Th∆∞·ªüng kh√°c</th><th>PC B·ªØa ƒÉn</th><th>PC H·ªì s∆°</th>
                <th><label><span>PC Ph·ª• n·ªØ</span><br><input type="checkbox" id="chk_phunu" class="save-chk" checked onchange="calculateAll()"></label></th>
                <th>PC Tr·∫ª nh·ªè</th><th class="total-cell">T·ªïng (2)</th>
            </tr>
            <tr>
                <td><strong>S·ªë ti·ªÅn</strong></td>
                <td><input type="text" class="money save" id="phep"></td><td><input type="text" class="money save" id="dcl"></td>
                <td><input type="text" class="money save" id="dean"></td><td><input type="text" class="money save" id="tk"></td>
                <td><input type="text" class="money save" id="buaan"></td><td><input type="text" class="money save" id="hoso"></td>
                <td id="phunu_res" class="auto-fill">0</td><td><input type="text" class="money save" id="trenho"></td>
                <td id="tong2" class="total-cell"></td>
            </tr>
        </table>
    </div>

    <div class="table-responsive">
        <table>
            <tr class="section-head"><th colspan="9">3. TƒÇNG CA (NH·∫¨P M·ªñI TH√ÅNG)</th></tr>
            <tr style="background: #fafafa;">
                <th width="80px">TƒÉng ca</th><th>TC 150%</th><th>TC ƒê√™m 200%</th><th>TC 22h 210%</th><th>TC CN 200%</th><th>TC ƒê√™m CN 270%</th><th>TC L·ªÖ 300%</th><th>TC ƒê√™m L·ªÖ 390%</th><th class="total-cell">T·ªïng (3)</th>
            </tr>
            <tr>
                <td><strong>Gi·ªù</strong></td>
                <td><input type="text" class="money save" id="g150"></td><td><input type="text" class="money save" id="g200"></td>
                <td><input type="text" class="money save" id="g210"></td><td><input type="text" class="money save" id="g200cn"></td>
                <td><input type="text" class="money save" id="g270"></td><td><input type="text" class="money save" id="g300"></td>
                <td><input type="text" class="money save" id="g390"></td><td rowspan="2" id="tong3" class="total-cell"></td>
            </tr>
            <tr>
                <td><strong>Ti·ªÅn</strong></td>
                <td id="r150" class="res-num"></td><td id="r200" class="res-num"></td><td id="r210" class="res-num"></td>
                <td id="r200cn" class="res-num"></td><td id="r270" class="res-num"></td><td id="r300" class="res-num"></td><td id="r390" class="res-num"></td>
            </tr>
        </table>
    </div>

    <div class="table-responsive">
        <table>
            <tr class="section-head"><th colspan="4">4. GI·∫¢M TR·ª™</th></tr>
            <tr>
                <th width="25%">B·∫£o hi·ªÉm (10.5%)</th><th width="25%">C√¥ng ƒëo√†n</th><th width="25%">Kho·∫£n tr·ª´ kh√°c</th><th class="total-cell">T·ªïng (4)</th>
            </tr>
            <tr>
                <td id="val_bhxh" style="color: red;"></td>
                <td><input type="text" id="val_congdoan" value="30,000" readonly></td>
                <td><input type="text" class="money save" id="val_trukhac"></td>
                <td id="tong4" style="color: red; font-weight: bold;"></td>
            </tr>
        </table>
    </div>

    <div class="final-box">
        <span style="font-size: 16px;">TH·ª∞C Lƒ®NH:</span> 
        <span class="grand-total" id="final_total">0</span>
    </div>
</div>

<script>
let isReady = false;
window.addEventListener('DOMContentLoaded', () => { load(); isReady = true; calculateAll(); });

function hideNotice() {
    document.getElementById('rotation-notice').style.display = 'none';
}

function clearSection1() {
    if(confirm("Xo√° to√†n b·ªô d·ªØ li·ªáu M·ª•c 1?")) {
        document.querySelectorAll('.group1').forEach(i => i.value = "");
        calculateAll();
    }
}

function calculateAll() {
    if(!isReady) return;
    const chu·∫©n = parseFloat(document.getElementById('soCongChuan').value) || 26;
    const th·ª±c = parseFloat(document.getElementById('soNgayGio').value.replace(/,/g, '')) || 0;
    const tile = th·ª±c / chu·∫©n;

    const g·ªëc = getVal('luongCB') + getVal('pccv') + getVal('pckn') + getVal('pctn') + getVal('pcno') + getVal('pcsk');
    const ƒë∆°nGi√° = g·ªëc / chu·∫©n / 8;
    const luongNgayCong = getVal('luongCB') * tile;
    
    const pnu_on = document.getElementById('chk_phunu').checked;
    const pnu_val = pnu_on ? (ƒë∆°nGi√° * 2.25) : 0;

    let tongLyThuyet1 = getVal('luongCB') + getVal('pccv') + getVal('pckn') + getVal('pcat') + getVal('pcpccc') + 
                        getVal('pcsk') + getVal('pctn') + getVal('pcdt') + getVal('pcno') + getVal('pcdl') + getVal('pccc');
    setTxt('tong1', tongLyThuyet1);

    const pcList = [
        {id:'pccv', res:'res_pccv'}, {id:'pckn', res:'res_pckn'}, {id:'pcat', res:'res_pcat'},
        {id:'pcpccc', res:'res_pcpccc'}, {id:'pcsk', res:'res_pcsk'}, {id:'pctn', res:'res_pctn'},
        {id:'pcdt', res:'res_pcdt'}, {id:'pcno', res:'res_pcno'}, {id:'pcdl', res:'res_pcdl'}, {id:'pccc', res:'res_pccc'}
    ];
    let tongPC1_thuc_te = 0;
    pcList.forEach(item => {
        let val = getVal(item.id) * tile;
        setTxt(item.res, val);
        tongPC1_thuc_te += val;
    });

    document.getElementById('show_luong_ngay_cong').innerText = Math.round(luongNgayCong).toLocaleString('en-US');
    document.getElementById('show_total_pc').innerText = Math.round(tongPC1_thuc_te).toLocaleString('en-US');
    document.getElementById('show_goc').innerText = Math.round(g·ªëc).toLocaleString('en-US');
    document.getElementById('phunu_res').innerText = pnu_val > 0 ? Math.round(pnu_val).toLocaleString('en-US') : "0";

    const ids2 = ['phep','dcl','dean','tk','buaan','hoso','trenho'];
    let t2_total = pnu_val; ids2.forEach(id => { t2_total += getVal(id); });
    setTxt('tong2', t2_total);

    const tcs = [{g:'g150',r:'r150',h:1.5},{g:'g200',r:'r200',h:2},{g:'g210',r:'r210',h:2.1},{g:'g200cn',r:'r200cn',h:2},{g:'g270',r:'r270',h:2.7},{g:'g300',r:'r300',h:3},{g:'g390',r:'r390',h:3.9}];
    let t3 = 0; tcs.forEach(x => { let s = ƒë∆°nGi√° * getVal(x.g) * x.h; setTxt(x.r, s); t3 += s; });
    setTxt('tong3', t3);

    const bh = (getVal('luongCB') + getVal('pccv') + getVal('pckn') + getVal('pcsk') + getVal('pctn')) * 0.105;
    const t4 = bh + 30000 + getVal('val_trukhac');
    setTxt('val_bhxh', bh); setTxt('tong4', t4);

    document.getElementById('final_total').innerText = Math.round(luongNgayCong + tongPC1_thuc_te + t2_total + t3 - t4).toLocaleString('en-US');
    save();
}

function getVal(id) { let el = document.getElementById(id); return (el && el.value) ? parseFloat(el.value.replace(/,/g,'')) || 0 : 0; }
function setTxt(id, v) { let el = document.getElementById(id); if(el) el.innerText = v>0 ? Math.round(v).toLocaleString('en-US') : ""; }

function save() { 
    const d = {}; document.querySelectorAll('.save').forEach(e => d[e.id]=e.value); 
    document.querySelectorAll('.save-chk').forEach(e => d[e.id]=e.checked);
    d['soCongChuan'] = document.getElementById('soCongChuan').value;
    localStorage.setItem('payroll_v2025_vFinal', JSON.stringify(d)); 
}

function load() { 
    const s = localStorage.getItem('payroll_v2025_vFinal'); if(!s) return;
    const d = JSON.parse(s); for(let k in d) { 
        let e = document.getElementById(k); if(e) { if(e.type === 'checkbox') e.checked = d[k]; else e.value = d[k]; }
    }
}

document.addEventListener('input', (e) => {
    if (e.target.classList.contains('money') || e.target.id === 'soCongChuan') {
        if (e.target.classList.contains('money') && !e.target.id.startsWith('g') && e.target.id !== 'soNgayGio') {
            let v = e.target.value.replace(/,/g,'');
            if(v!=="" && !isNaN(v)) e.target.value = parseFloat(v).toLocaleString('en-US');
        }
        calculateAll();
    }
});
</script>
</body>
</html>